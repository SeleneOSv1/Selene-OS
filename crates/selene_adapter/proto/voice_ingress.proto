syntax = "proto3";

package selene.adapter.v1;

service VoiceIngress {
  rpc RunVoiceTurn(RunVoiceTurnRequest) returns (RunVoiceTurnResponse);
  rpc UiHealthReportQuery(UiHealthReportQueryRequest) returns (UiHealthReportQueryResponse);
}

message RunVoiceTurnAudioCaptureRef {
  uint64 stream_id_hi = 1;
  uint64 stream_id_lo = 2;
  uint64 pre_roll_buffer_id = 3;
  uint64 t_start_ns = 4;
  uint64 t_end_ns = 5;
  uint64 t_candidate_start_ns = 6;
  uint64 t_confirmed_ns = 7;
  optional string locale_tag = 8;
  optional string device_route = 9;
  optional string selected_mic = 10;
  optional string selected_speaker = 11;
  optional bool tts_playback_active = 12;
  optional string detection_text = 13;
  optional uint32 detection_confidence_bp = 14;
  optional uint32 vad_confidence_bp = 15;
  optional uint32 acoustic_confidence_bp = 16;
  optional uint32 prosody_confidence_bp = 17;
  optional uint32 speech_likeness_bp = 18;
  optional uint32 echo_safe_confidence_bp = 19;
  optional uint32 nearfield_confidence_bp = 20;
  optional bool capture_degraded = 21;
  optional bool stream_gap_detected = 22;
  optional bool aec_unstable = 23;
  optional bool device_changed = 24;
  optional sint32 snr_db_milli = 25;
  optional uint32 clipping_ratio_bp = 26;
  optional uint32 echo_delay_ms_milli = 27;
  optional uint32 packet_loss_bp = 28;
  optional uint32 double_talk_bp = 29;
  optional sint32 erle_db_milli = 30;
  optional uint32 device_failures_24h = 31;
  optional uint32 device_recoveries_24h = 32;
  optional uint32 device_mean_recovery_ms = 33;
  optional uint32 device_reliability_bp = 34;
  optional uint32 timing_jitter_ms_milli = 35;
  optional uint32 timing_drift_ppm_milli = 36;
  optional uint32 timing_buffer_depth_ms_milli = 37;
  optional uint64 timing_underruns = 38;
  optional uint64 timing_overruns = 39;
}

message RunVoiceTurnVisualTokenRef {
  string token = 1;
  optional uint32 x = 2;
  optional uint32 y = 3;
  optional uint32 w = 4;
  optional uint32 h = 5;
}

message RunVoiceTurnVisualInputRef {
  optional bool turn_opt_in_enabled = 1;
  string source_id = 2;
  string source_kind = 3;
  string image_ref = 4;
  string blob_ref = 5;
  repeated RunVoiceTurnVisualTokenRef visible_tokens = 6;
}

message RunVoiceTurnRequest {
  uint64 correlation_id = 1;
  uint64 turn_id = 2;
  string app_platform = 3;
  string trigger = 4;
  string actor_user_id = 5;
  string tenant_id = 6;
  string device_id = 7;
  uint64 now_ns = 8;
  RunVoiceTurnAudioCaptureRef audio_capture_ref = 9;
  RunVoiceTurnVisualInputRef visual_input_ref = 10;
}

message RunVoiceTurnResponse {
  string status = 1;
  string outcome = 2;
  string reason = 3;
}

message UiHealthReportQueryRequest {
  uint64 correlation_id = 1;
  uint64 turn_id = 2;
  string tenant_id = 3;
  string viewer_user_id = 4;
  string report_kind = 5;
  uint64 from_utc_ns = 6;
  uint64 to_utc_ns = 7;
  string engine_owner_filter = 8;
  string company_scope = 9;
  repeated string company_ids = 10;
  repeated string country_codes = 11;
  bool escalated_only = 12;
  bool unresolved_only = 13;
  string display_target = 14;
  string page_action = 15;
  string page_cursor = 16;
  string report_context_id = 17;
  uint32 page_size = 18;
}

message UiHealthReportRow {
  string tenant_id = 1;
  string issue_id = 2;
  string owner_engine_id = 3;
  string severity = 4;
  string status = 5;
  string latest_reason_code = 6;
  uint64 last_seen_at_ns = 7;
  string bcast_id = 8;
  string ack_state = 9;
  string issue_fingerprint = 10;
  bool recurrence_observed = 11;
  string impact_summary = 12;
  repeated string attempted_fix_actions = 13;
  string current_monitoring_evidence = 14;
  string unresolved_reason_exact = 15;
}

message UiHealthReportPaging {
  bool has_next = 1;
  bool has_prev = 2;
  string next_cursor = 3;
  string prev_cursor = 4;
}

message UiHealthReportQueryResponse {
  string status = 1;
  uint64 generated_at_ns = 2;
  string reason_code = 3;
  string report_context_id = 4;
  uint64 report_revision = 5;
  string normalized_query = 6;
  repeated UiHealthReportRow rows = 7;
  UiHealthReportPaging paging = 8;
  string display_target_applied = 9;
  string remembered_display_target = 10;
  string requires_clarification = 11;
}
